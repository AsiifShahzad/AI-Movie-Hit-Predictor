## Docker & AWS Lambda Deployment - Quick Start

### üê≥ Step 1: Build and Test Locally

```bash
cd /home/asif/AI-Movie-Hit-Predictor

# Build Docker image
docker build -t movie-revenue-predictor:latest .

# Run container
docker run -p 8000:8000 movie-revenue-predictor:latest

# Test in another terminal
curl http://localhost:8000/health
```

---

### üì¶ Step 2: Setup AWS

```bash
# Install AWS CLI
pip install awscli

# Configure AWS
aws configure
# Enter: AWS Access Key ID, Secret Access Key, Region, Output format

# Get your Account ID
aws sts get-caller-identity --query Account --output text
```

---

### üîê Step 3: Create ECR Repository

```bash
# Variables
AWS_REGION="us-east-1"  # Change to your region
AWS_ACCOUNT_ID="123456789012"  # Replace with your account ID

# Create repository
aws ecr create-repository \
    --repository-name movie-revenue-predictor \
    --region $AWS_REGION
```

---

### üì§ Step 4: Push to ECR (Choose One)

#### **Option A: Using Script (Easiest)**
```bash
# Edit script with your Account ID
nano deploy-to-ecr.sh
# Update: AWS_ACCOUNT_ID="your-id"

# Run script
chmod +x deploy-to-ecr.sh
./deploy-to-ecr.sh
```

#### **Option B: Manual Push**
```bash
# Login to ECR
aws ecr get-login-password --region $AWS_REGION | \
    docker login --username AWS --password-stdin \
    $AWS_ACCOUNT_ID.dkr.ecr.$AWS_REGION.amazonaws.com

# Tag image
docker tag movie-revenue-predictor:latest \
    $AWS_ACCOUNT_ID.dkr.ecr.$AWS_REGION.amazonaws.com/movie-revenue-predictor:latest

# Push
docker push \
    $AWS_ACCOUNT_ID.dkr.ecr.$AWS_REGION.amazonaws.com/movie-revenue-predictor:latest
```

---

### ‚ö° Step 5: Deploy to Lambda

#### **Option A: AWS Console (Recommended)**
1. Go to **AWS Lambda** console
2. **Create function** ‚Üí **Container image**
3. **Container image URI**: (copy from ECR)
   ```
   123456789012.dkr.ecr.us-east-1.amazonaws.com/movie-revenue-predictor:latest
   ```
4. **Memory**: 512 MB
5. **Timeout**: 60 seconds
6. **Create function**

#### **Option B: AWS CLI**
```bash
aws lambda create-function \
    --function-name movie-revenue-predictor \
    --role arn:aws:iam::$AWS_ACCOUNT_ID:role/lambda-execution-role \
    --code ImageUri=$AWS_ACCOUNT_ID.dkr.ecr.$AWS_REGION.amazonaws.com/movie-revenue-predictor:latest \
    --package-type Image \
    --timeout 60 \
    --memory-size 512 \
    --region $AWS_REGION
```

---

### üåê Step 6: Setup API Gateway (Optional)

For HTTP access to your Lambda function:

1. Go to **API Gateway** in AWS console
2. **Create API** ‚Üí **REST API**
3. **Create Resource** and **Create Method** (POST, GET)
4. **Integration**: Lambda Function
5. **Deploy API**
6. Get your API endpoint URL

---

### üß™ Step 7: Test Lambda

```bash
# Via AWS CLI
aws lambda invoke \
    --function-name movie-revenue-predictor \
    --payload '{"body":"{}"}' \
    response.json

cat response.json
```

---

### üîÑ Step 8: Update After Code Changes

```bash
# Rebuild and push
docker build -t movie-revenue-predictor:latest .

docker tag movie-revenue-predictor:latest \
    $AWS_ACCOUNT_ID.dkr.ecr.$AWS_REGION.amazonaws.com/movie-revenue-predictor:latest

docker push \
    $AWS_ACCOUNT_ID.dkr.ecr.$AWS_REGION.amazonaws.com/movie-revenue-predictor:latest

# Update Lambda function
aws lambda update-function-code \
    --function-name movie-revenue-predictor \
    --image-uri $AWS_ACCOUNT_ID.dkr.ecr.$AWS_REGION.amazonaws.com/movie-revenue-predictor:latest
```

---

### üìä Files Created

- **Dockerfile** - Container configuration
- **docker-compose.yml** - Local testing with Docker Compose
- **.dockerignore** - Files to exclude from build
- **deploy-to-ecr.sh** - Automated ECR push script
- **AWS_LAMBDA_DEPLOYMENT.txt** - Detailed guide

---

### ‚ö†Ô∏è Important Notes

1. **Model Size**: Models are ~55 MB (included in container)
2. **Memory**: Minimum 512 MB for Lambda (increase if needed)
3. **Timeout**: Set to 60+ seconds (models take time to load)
4. **Cold Start**: First request may take 10-30 seconds
5. **Cost**: ~$0.05/day for 1,000 predictions

---

### üÜò Troubleshooting

| Issue | Solution |
|-------|----------|
| Docker build fails | Check Dockerfile syntax, run `docker build -t test .` |
| ECR push fails | Verify AWS credentials: `aws sts get-caller-identity` |
| Lambda timeout | Increase timeout to 60+ seconds, check model loading time |
| Out of memory | Increase Lambda memory to 1024+ MB |
| API Gateway 504 | Check Lambda execution logs: `aws logs tail /aws/lambda/...` |

---

### üìö Next Steps

1. ‚úÖ Build Docker image locally
2. ‚úÖ Test with `docker run`
3. ‚úÖ Setup AWS credentials
4. ‚úÖ Push to ECR
5. ‚úÖ Deploy to Lambda
6. ‚úÖ Test via API Gateway

See **AWS_LAMBDA_DEPLOYMENT.txt** for detailed step-by-step guide!
